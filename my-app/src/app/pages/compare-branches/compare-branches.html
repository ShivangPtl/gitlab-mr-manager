<div class="create-branch-container ">
  <section class="defaults mat-theme">
    <h2 style="margin-top: 0;">Branch Compare </h2>

    <div class="controls">

      <mat-form-field appearance="fill">
        <mat-label>Source Branch</mat-label>
        <input matInput [(ngModel)]="sourceBranch" (input)="resetDataSource()" />
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Target Branch</mat-label>
        <input matInput [(ngModel)]="targetBranch" (input)="resetDataSource()" />
      </mat-form-field>

      <!-- <div class="theme-toggle-container">
        <mat-label class="branch-icon">Protect Branch</mat-label>

        <mat-slide-toggle [(ngModel)]="isProtected" color="primary">
        </mat-slide-toggle>
      </div> -->

    </div>
  </section>


  <section class="projects">
    <h2 style="margin-top: 0;">Projects</h2>

    <table mat-table [dataSource]="dataSource" class="mat-elevation-z2 full-width-table">

      <!-- Select -->
      <ng-container matColumnDef="select">
        <th mat-header-cell *matHeaderCellDef>Select</th>
        <td mat-cell *matCellDef="let project">
          <mat-checkbox [(ngModel)]="project.is_selected"></mat-checkbox>
        </td>
      </ng-container>

      <!-- Project Name -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Project Name</th>
        <td mat-cell *matCellDef="let project">{{ project.project_name }}</td>
      </ng-container>

      <!-- Branches -->
      <!-- <ng-container matColumnDef="branches">
        <th mat-header-cell *matHeaderCellDef>Branches</th>
        <td mat-cell *matCellDef="let project">
          <code [class.invalid]="!project.sourceBranchExists">
            {{ sourceBranch }}
          </code>
          ‚Üí
          <code [class.invalid]="!project.targetBranchExists">
            {{ targetBranch }}
          </code>
        </td>
      </ng-container> -->
      <ng-container matColumnDef="branches">
        <th mat-header-cell *matHeaderCellDef class="text-center">Branches</th>
        <td mat-cell *matCellDef="let project" class="text-center">
      
          <div class="branch-pill-container">
      
            <!-- Source branch -->
            <span class="branch-pill" [ngClass]="project.sourceBranchExists == undefined ? '' : (project.sourceBranchExists ? 'pill-ok' : 'pill-error')">
              {{ sourceBranch }}
              <span *ngIf="project.sourceBranchExists == false" class="pill-close">‚úï</span>
            </span>
      
            <span class="branch-arrow">‚Üí</span>
      
            <!-- Target branch -->
            <span class="branch-pill" [ngClass]="project.targetBranchExists == undefined ? '' : (project.targetBranchExists ? 'pill-ok' : 'pill-error')">
              {{ targetBranch }}
              <span *ngIf="project.targetBranchExists == false" class="pill-close">‚úï</span>
            </span>
      
          </div>
      
        </td>
      </ng-container>
      

      <!-- Ahead -->
      <ng-container matColumnDef="ahead">
        <th mat-header-cell *matHeaderCellDef class="text-center">Ahead</th>
        <td mat-cell *matCellDef="let project" class="text-center">
          <span *ngIf="project.ahead > 0" class="ahead-badge">
            <mat-icon inline>arrow_upward</mat-icon>
            {{ project.ahead }}
          </span>
          <span *ngIf="project.ahead === 0 || project.ahead === '-'" class="muted">‚Äî</span>
        </td>
      </ng-container>      

      <!-- Behind -->
      <ng-container matColumnDef="behind">
        <th mat-header-cell *matHeaderCellDef class="text-center">Behind</th>
        <td mat-cell *matCellDef="let project" class="text-center">
          <span *ngIf="project.behind > 0" class="behind-badge">
            <mat-icon inline>arrow_downward</mat-icon>
            {{ project.behind }}
          </span>
          <span *ngIf="project.behind === 0 || project.behind === '-'" class="muted">‚Äî</span>
        </td>
      </ng-container>      

      <!-- Deploy -->
      <ng-container matColumnDef="deploy">
        <th mat-header-cell *matHeaderCellDef class="text-center">Deploy</th>
        <td mat-cell *matCellDef="let project" class="text-center">
          <span
            class="deploy-icon"
            [ngClass]="getDeployClass(project)"
            [title]="getDeployText(project)">
            {{ getDeployIcon(project) }}
          </span>
        </td>
      </ng-container>

      <!-- Config -->
      <ng-container matColumnDef="config">
        <th mat-header-cell *matHeaderCellDef class="text-center">Config</th>
        <td mat-cell *matCellDef="let project" class="text-center">

          <!-- <span *ngIf="project.configFiles?.length"
                class="config-warning"
                [matTooltip]="project.configFiles.join('\n')"
                matTooltipClass="config-tooltip"
                matTooltipPosition="above">
            ‚ö†Ô∏è
          </span> -->
          <button mat-icon-button *ngIf="project.configFiles?.length" class="warning" (click)="openConfigDetails(project)"
          [matTooltip]="project.configFiles.join('\n')" matTooltipClass="config-tooltip" matTooltipPosition="above">
          <mat-icon>warning</mat-icon>
        </button>
          <span *ngIf="!project.configFiles?.length">‚Äî</span>
        </td>
      </ng-container>

      <!-- Header + Rows -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

    </table>
  </section>


  <div class="actions">
    <!-- Left: Last Refreshed Info -->
    <div class="refresh-info">
      ‚è±Ô∏è Last refreshed: {{ lastRefreshed | date: 'dd/MM/yyyy hh:mm a' }}
    </div>
    <div class="button-group">
      <button mat-raised-button class="themed-btn"
              (click)="compareBranches()">
        üîÄ Compare
      </button>
    </div>
  </div>
</div>
